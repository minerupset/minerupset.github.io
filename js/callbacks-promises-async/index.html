



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Callbacks, Promises, & Async - Miner Curiosity</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra_css/extra.css">
    
    
      
    
    
<meta name="robots" content="noindex"/>

  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#javascript-callbacks-promises-and-async" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Miner Curiosity" class="md-header-nav__button md-logo">
          
            <i class="md-icon">book</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Miner Curiosity
            </span>
            <span class="md-header-nav__topic">
              
                Callbacks, Promises, & Async
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Miner Curiosity" class="md-nav__button md-logo">
      
        <i class="md-icon">book</i>
      
    </a>
    Miner Curiosity
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      C#
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        C#
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../csharp/hello-world/" title="Hello World" class="md-nav__link">
      Hello World
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/hello-world/" title="Hello World" class="md-nav__link">
      Hello World
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/working-with-files/" title="Working With Files" class="md-nav__link">
      Working With Files
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Node.JS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Node.JS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hello-world/" title="Hello World" class="md-nav__link">
      Hello World
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intro-to-webscraping/" title="Intro to Webscraping" class="md-nav__link">
      Intro to Webscraping
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      React.JS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        React.JS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hello-react/" title="Hello React" class="md-nav__link">
      Hello React
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Other JS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Other JS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hello-jquery/" title="Hello jQuery" class="md-nav__link">
      Hello jQuery
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Callbacks, Promises, & Async
      </label>
    
    <a href="./" title="Callbacks, Promises, & Async" class="md-nav__link md-nav__link--active">
      Callbacks, Promises, & Async
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-does-js-need-any-of-this" class="md-nav__link">
    Why does JS need any of this?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks-to-hell-and-back" class="md-nav__link">
    Callbacks: to Hell and Back
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#promises-save-us-from-hell" class="md-nav__link">
    Promises: Save Us from Hell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-multiple-promises-get-all-the-promises" class="md-nav__link">
    Calling Multiple Promises: Get All the Promises
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-await-sugar-coated-promises" class="md-nav__link">
    Async / Await: Sugar Coated Promises
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Git / GitHub
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Git / GitHub
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../git/intro/" title="Git Introduction" class="md-nav__link">
      Git Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../git/reminders/" title="Git Reminders" class="md-nav__link">
      Git Reminders
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Databases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/intro-to-dbs/" title="Basic DB Information" class="md-nav__link">
      Basic DB Information
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Other Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Other Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../other/vs-code-tools/" title="VS Code Tools" class="md-nav__link">
      VS Code Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../other/html-and-css/" title="Basic HTML & CSS" class="md-nav__link">
      Basic HTML & CSS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../other/os-scripting/" title="Terminal / Shell Scripting" class="md-nav__link">
      Terminal / Shell Scripting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../otherrpi-for-development.md" title="RPi For Development" class="md-nav__link">
      RPi For Development
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-does-js-need-any-of-this" class="md-nav__link">
    Why does JS need any of this?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks-to-hell-and-back" class="md-nav__link">
    Callbacks: to Hell and Back
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#promises-save-us-from-hell" class="md-nav__link">
    Promises: Save Us from Hell
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-multiple-promises-get-all-the-promises" class="md-nav__link">
    Calling Multiple Promises: Get All the Promises
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-await-sugar-coated-promises" class="md-nav__link">
    Async / Await: Sugar Coated Promises
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="javascript-callbacks-promises-and-async">JavaScript - Callbacks, Promises, and Async</h1>
<hr>

<h2 id="why-does-js-need-any-of-this">Why does JS need any of this?</h2>
<p>Unlike local desktop applications, websites have to deal with the reality of decentralized systems. Decentralized systems are great for parallel processing and spreading data around, but what happens if one of your partner systems is down? Or if your internet is slow? You can't have a website just not load at all - users would stop coming. Instead, the web had to be built on the fundamentals of asynchronous actions. This means that a process might finish in half a second, 5 seconds, or 15 seconds, and your website still has to function. </p>
<p>JavaScript, being the language of the web, needs to handle this, and handle it cleanly. The methods for doing this have changed over time, starting with callbacks, then Promises, then async/await functions. I'll approach them chronologically here, but don't spend too much time on callbacks. They should be avoided when possible because of the anti-patterns they create. If you're maintaining legacy code, you should replace your callbacks with at least Promises, if not async/await functions. </p>
<p>To start off, it's great to have a way to model and test these kinds of delayed events. The very simple JavaScript method <code class="codehilite"><span class="nx">setTimeout</span><span class="p">()</span></code> will serve well in creating delayed events that could easily happen with arbitrary database / network calls.</p>
<p>For these exercises, let's think of a very basic thing that might happen in a standard REST API construct: you call to get a specific user, then you want to get all of those users blog posts, then you want to get all of the comments on the first blog post. Three sequential API calls that all depend on each other in sequence. </p>
<p><em>(Note: shout out to several various web blog posts and tutorials for coming up with similar training examples - I believe Mosh Hamedani had one on GitHub users, which is also frequently done)</em></p>
<h2 id="callbacks-to-hell-and-back">Callbacks: to Hell and Back</h2>
<p>Let's start with the first one, getting our user:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">getUser</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">ourCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Reading user from the db...&#39;</span><span class="p">)</span>
        <span class="nx">ourCallback</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="nx">id</span><span class="p">,</span> <span class="nx">userName</span><span class="o">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">});</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>    
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>So we did two things when we called the <code class="codehilite"><span class="nx">getUser</span><span class="p">()</span></code> function. We asked for user with id <code class="codehilite"><span class="mi">1</span></code> and, when that user was found, we asked the function <code class="codehilite"><span class="nx">ourCallback</span><span class="p">()</span></code> to be called. In this case, we just set an arbitrary time out of 2000ms, but it's the same idea. We took 2 seconds to find our user object <code class="codehilite"><span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="o">:</span><span class="s1">&#39;Bob&#39;</span><span class="p">}</span></code> and when it was returned, we simply logged it to the console using our arrow function. </p>
<p>This gets out of hand really fast though when you have to start nesting these calls. Lets look at our example of getting that users blog posts, and then the comments on their first blog post:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">getPosts</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">(</span><span class="nx">blogPosts</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">getComments</span><span class="p">(</span><span class="nx">blogPosts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nx">comments</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">comments</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>I haven't fleshed out each of these methods of <code class="codehilite"><span class="nx">getPosts</span><span class="p">()</span></code> and <code class="codehilite"><span class="nx">getComments</span><span class="p">()</span></code>, but we don't need to. This code is clear: get a user with <code class="codehilite"><span class="nx">id</span></code> of 1, then get the posts associated with that user, then get the comments associated with a given post, then log those comments. This gets nested really quickly in an ugly way. <strong>This is 'Callback Hell'</strong>, when the functions and callbacks get nested and indented farther and farther (also sometimes called the Christmas tree problem). </p>
<p>Now, we can fix this by using named functions, but honestly, it's not that much better, because you wind up just calling <code class="codehilite"><span class="nx">getUser</span><span class="p">()</span></code> and that implicitly has all the other functions beneath it. Hardly good from a code readability standpoint. </p>
<h2 id="promises-save-us-from-hell">Promises: Save Us from Hell</h2>
<p>Promises get a bit dicey, so here is a clear defintion:</p>
<div class="admonition note">
<p><strong>A Promise is an object that holds the result of an asynchronous task</strong></p>
</div>
<p>Important to note here that it is a normal JavaScript object, and that it holds the eventual result of some work that will take an undetermined amount of time. It has three phases (and one nonexistent phase):</p>
<ul>
<li>Pending (it's in process)</li>
<li>Resolved (or fulfilled, completed with a result)</li>
<li>Rejected (or failed with some kind of error)</li>
<li>Undefined (it's not really a state of the Promise, but the Promise doesn't exist anymore)</li>
</ul>
<p>Let's look at an example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">flipCoin</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">ourPromise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">coinTossResult</span> <span class="o">=</span> <span class="nx">flipCoin</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">coinTossResult</span><span class="p">)</span>
            <span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;Heads&#39;</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Came up tails&#39;</span><span class="p">));</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">ourPromise</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Result of our Promise&#39;</span><span class="p">,</span><span class="nx">result</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
</pre></div>
</td></tr></table>

<p>This is example creates a promise that essentially flips a coin and if it's 0, it's heads, if it's 1, it's tails. But let's look at our Promise:</p>
<ul>
<li>It's an object with a <code class="codehilite"><span class="p">.</span><span class="nx">then</span><span class="p">()</span></code> method for if it resolves</li>
<li>If it errors out for any reason, the <code class="codehilite"><span class="p">.</span><span class="k">catch</span><span class="p">()</span></code> method is invoked.</li>
</ul>
<p>Let's take our previous callback methods and replace them with Promises:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// getUser(1, (user) =&gt; {</span>
<span class="c1">//     getPosts(user.id, (blogPosts) =&gt; {</span>
<span class="c1">//         getComments(blogPosts[0], (comments) =&gt; {</span>
<span class="c1">//             console.log(comments);</span>
<span class="c1">//         });</span>
<span class="c1">//     });</span>
<span class="c1">// });</span>

<span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="p">=&gt;</span> <span class="nx">getPosts</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">blogPosts</span> <span class="p">=&gt;</span> <span class="nx">getComments</span><span class="p">(</span><span class="nx">blogPosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">comments</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="nx">comments</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
</pre></div>
</td></tr></table>

<p>So, this code reads a little more cleanly. It still isn't quite as clean as completely synchronous code, but it's an improvement:</p>
<ul>
<li><code class="codehilite"><span class="nx">getUser</span></code> with id of 1</li>
<li>once you have that user, get their posts</li>
<li>once you have the posts, get the comments from the first post</li>
<li>once you have the comments, log them to the console</li>
</ul>
<p>This will run patiently and sequentially, waiting until the results are completed before moving on to the next <code class="codehilite"><span class="p">.</span><span class="nx">then</span><span class="p">()</span></code> statement. This is also referred to as <em><strong>chaining</strong></em> our Promise statements together. As well, if an error occurs on <em>any</em> step, it will go to the <code class="codehilite"><span class="p">.</span><span class="k">catch</span><span class="p">()</span></code> statement, so there's no need to error handle each then statement on the way down. </p>
<h2 id="calling-multiple-promises-get-all-the-promises">Calling Multiple Promises: Get All the Promises</h2>
<p>So if you're like me, one of the first things you want to do is run a bunch of Promises simultaneously. I don't mean chaining 3 Promises back to back like we did, but run those 3 chained Promises 100 times to test performance. To do this, you need to put all of the Promise objects into an array, and make use of the <code class="codehilite"><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></code> function. This allows the separate Promise chains to run such that they're not blocking each other (asynchronously), but each individual Promise will follow its own chain of <code class="codehilite"><span class="p">.</span><span class="nx">then</span><span class="p">()</span></code> statements. </p>
<p>Let's look at how I handled this in my example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">promiseArray</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">resultArray</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">promiseArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
        <span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="p">=&gt;</span> <span class="nx">getPosts</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">blogPosts</span> <span class="p">=&gt;</span> <span class="nx">getComments</span><span class="p">(</span><span class="nx">blogPosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">comments</span> <span class="p">=&gt;</span> <span class="nx">resultArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">entry</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">))</span>
            <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">resultArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promiseArray</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Results&quot;</span><span class="p">,</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">resultArray</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> 
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Error in the overall promising&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="nx">resultArray</span><span class="p">));</span>
</pre></div>
</td></tr></table>

<p>So, we've built an array that makes our group of Promises - we have them push to a separate array of results because our Promises are objects that will become undefined once they're completed, so we want to retain those results after the fact.</p>
<p>Now note: we have our promise array essentially protected against the overall failure. What this means is that if one of our chains of getting users, then posts, then comments fails, the whole thing won't fail, because we our array of promises never has the errors passed up to them. We never pass the reject function forward. This was done intentionally in this example so that if one out of our 100 promises failed, it doesn't torpedo the other 99, but note that there are times when you do want that to fail. If so, you need to elevate that failure so that the <code class="codehilite"><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></code> call will receive the <code class="codehilite"><span class="nx">reject</span><span class="p">()</span></code> call and then hit its <code class="codehilite"><span class="k">catch</span><span class="p">()</span></code> statement.</p>
<p>This is definitely an area I need to dig more; I won't pretend this is the be-all end-all explanation of Promises, but instead a means of investigating them. I'm sure I'll be building this out as I go.</p>
<h2 id="async-await-sugar-coated-promises">Async / Await: Sugar Coated Promises</h2>
<p>We've spent all this time looking at Promise architectures, but now, we're going to get rid of it - Promises are great, and it's important to know how they work, but realistically, they have a very different flow in their structure than does normal code. It would be great to keep writing in a synchronous style, and just have Promises work. This is where <code class="codehilite"><span class="nx">async</span></code> and <code class="codehilite"><span class="nx">await</span></code> come in (very similar to C#'s use of <code class="codehilite"><span class="k">async</span></code> and <code class="codehilite"><span class="k">await</span></code> with C# Task objects).</p>
<p>Below is a direct comparison of our same three versions: Callbacks, Promises, and Async/Await</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//Callback Based</span>
<span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">getPosts</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">(</span><span class="nx">blogPosts</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">getComments</span><span class="p">(</span><span class="nx">blogPosts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nx">comments</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">comments</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="c1">//Promise based</span>
<span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="p">=&gt;</span> <span class="nx">getPosts</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">blogPosts</span> <span class="p">=&gt;</span> <span class="nx">getComments</span><span class="p">(</span><span class="nx">blogPosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">comments</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Comment&#39;</span><span class="p">,</span> <span class="nx">comments</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>

<span class="c1">//Async / Await based</span>
<span class="nx">async</span> <span class="kd">function</span> <span class="nx">displayComments</span><span class="p">(){</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getUser</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">blogPosts</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getPosts</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">comments</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getComments</span><span class="p">(</span><span class="nx">blogPosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">,</span> <span class="nx">comments</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">displayComments</span><span class="p">();</span>
</pre></div>
</td></tr></table>

<p>So what did we do with our Async / Await functionality? Three major changes:</p>
<ol>
<li>First, we put <code class="codehilite"><span class="nx">await</span></code> in front of all of our methods that return Promises. This allows us to stop chaining them together and just treat them like normal synchronous code</li>
<li>We had to wrap all of that in an <code class="codehilite"><span class="nx">async</span></code> function - JavaScript requires that functions that have <code class="codehilite"><span class="nx">await</span></code> elements must be called in an asynchronous manner, so we just created our wrapper function <code class="codehilite"><span class="nx">displayComments</span><span class="p">()</span></code> to handle that for us</li>
<li>On their own, <code class="codehilite"><span class="nx">await</span></code> functions don't have error handling, so we wrapped it in a traditional <code class="codehilite"><span class="k">try</span><span class="p">...</span><span class="k">catch</span></code> block. While this may feel a bit klunkier than the elegant <code class="codehilite"><span class="p">.</span><span class="k">catch</span><span class="p">()</span></code> method we saw with Promises, it's much more consistent with the rest of the code, and consistency is always nice. </li>
</ol>
<p>Keep in mind, it's a false dichotomy to pit Promises against Async / Await functionality - they're inherently the same. Async / Await is just some syntactic sugar wrapped around Promise architecture so that we don't need to keep in mind the unique API of a Promise. This keeps us more consistent with our structures, and generally leads to better code. Does it add more lines? Yes. Yes it does. But lines are not the only metric of code readability - we've sacrificed adding a couple of additional lines to have a consistent and readable structure that flows like our remaining synchronous code. </p>
<p><span style='font-size: 0.75em'>Accurate as of January 15, 2020</span></p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
<hr />
<div class="footer-container">
  <p class="footer-p">
    A training website intended to record learning. Visit
    <a href="https://minerupset.github.io/legal/">Legal</a> page for more
    information. Built with
    <a href="https://www.mkdocs.org" target="_blank">MkDocs</a>
  </p>
  <p id="random-quote-block">
    <span id="quotes-quote"></span><br/></span> - <span id="quotes-author"></span>
  </p>
</div>

    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../extra_js/extra.js"></script>
      
    
  </body>
</html>